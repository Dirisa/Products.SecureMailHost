<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    lang="en"
    metal:use-macro="here/main_template/macros/master"
    i18n:domain="plonehelpcenter">

<head>
    <metal:css fill-slot="css_slot">
    <style type="text/css" media="all"
           tal:content="string: @import url($portal_url/helpcenter.css);"></style>
    </metal:css>
</head>

<body>
    <div metal:fill-slot="main">
        <div metal:define-macro="body" 
             tal:define="req_section request/section|nothing; 
                         faqpath python: '/'.join(here.getPhysicalPath()); 
                         pss python:modules['Products.PythonScripts.standard']; 
                         full request/full|nothing">

        <h1 tal:content="here/Title">
        Folder Title
        </h1>
        
        <tal:entirefaq condition="python: req_section or not full">
        <a class="link-expand"
           tal:attributes="href python:'%s?full=1' % here.absolute_url()">View entire FAQ in full</a>
        </tal:entirefaq>

        <tal:toc condition="python: full and not req_section">
        <a class="link-parent"
           tal:attributes="href python:'%s' % here.absolute_url()">Up to table of contents</a>
        </tal:toc>

        <div tal:condition="request/form/section |nothing">
            <a href=""
                class="link-parent"
                tal:define="parent_url here/absolute_url"
                tal:condition="python: req_section"
                tal:attributes="href parent_url"
                i18n:translate="go_to_parent_url">
                Up one level
            </a>
        </div>

        <div class="documentDescription"
             tal:content="here/Description">
        Description.
        </div>
        
        <div tal:define="sections python:test(req_section,[req_section],here.sections);
                         objects python:context.objectValues();" 
             tal:repeat="section sections">
 
            <h2 tal:content="section">Section Heading</h2>
 
            <tal:section condition="python: not full and not req_section">
                <a class="link-expand"
                   tal:attributes="href python:'%s?full=1&section=%s' % (here.absolute_url(), pss.url_quote(section) )">
                View section in full</a> 
            </tal:section>
 
            <ul tal:condition="not: full">
                <li tal:repeat="faq python: [o for o in objects if o.portal_type=='HelpCenterFAQ' and section in o.Subject()]">
                <a href="" tal:content="faq/Title"
                    tal:attributes="href faq/absolute_url">FAQ Question</a>
                </li>
            </ul>
            <div tal:condition="full" 
                 tal:define="values python: here.objectValues()"
                 tal:repeat="faq python: [o for o in objects if o.portal_type=='HelpCenterFAQ' and section in o.Subject()]">
                                         <tal:comment replace="nothing">The above invocation should really be a method on the class - def getFaqItemsBySection(section)</tal:comment>
                <metal:faq metal:use-macro="here/faq_view/macros/faq" />
 
            </div>
        </div>
        </div>
    </div>
</body>

</html>
