<metal:main_macro define-macro="main"
                  tal:define="errors options/state/getErrors|nothing;
                              wf_state python:here.portal_securityinjector.getInfoFor(here,'review_state',None);
                              Iterator python:modules['Products.CMFPlone'].IndexIterator;
                              tabindex python:Iterator(pos=30000);
                              review_state wf_state;">
          <div class="field">
            <label i18n:translate="label_change_status">Change State</label>
            <div class="formHelp"
                 i18n:translate="help_change_status">
              Select the new state for the selected items.
            </div>

            <div tal:define="tabindex tabindex/next;
                             error_workflow_action errors/workflow_action|nothing;
                             objs request/ids|nothing;
                             review_state_label string:No change;
                             target python:test(objs, objs, here);"
                 tal:attributes="class python:test(error_workflow_action, 'field error', 'field')">

              <div tal:condition="error_workflow_action">
                <tal:block i18n:translate="text_error" content="error_workflow_action">Error</tal:block>
                <br />
              </div>

              <span tal:replace="nothing">
                For usability we will want to signify what state we
                are currently in. DCWorkflow only returns what t
                ransitions are available.  But we want to visually
                represent what *state* we are currently in along with
                possible transitions.
              </span>

              <input class="noborder"
                     id=""
                     type="radio"
                     name="workflow_action"
                     title=""
                     value=""
                     tal:attributes="value review_state;
                                     title review_state;
                                     checked python:test(request.get('workflow_action', review_state)==review_state,1,0);" />
              <label for=""
                     i18n:translate=""
                     tal:attributes="for review_state;"
                     tal:content="review_state_label"
                     >Transition Name</label>
                     <br />

                     <tal:block define="transitions python:here.portal_securityinjector.getTransitionsFor(target, here)"
                                repeat="transition transitions">
                       <input class="noborder"
                              id=""
                              type="radio"
                              name="workflow_action"
                              title=""
                              value=""
                              i18n:attributes="title"
                              tal:attributes="value transition/id;
                                              id    transition/id;
                                              title transition/name;
                                              checked python:test(transition.get('id') == request.get('workflow_action', ''), 'checked', None)" />
                       <label for=""
                              i18n:translate=""
                              tal:attributes="for transition/id;"
                              tal:content="transition/name"
                              >Transition Name</label>
                              <br />
                     </tal:block>

            </div>

          </div>

          <div class="formControls">
            <input class="context"
                   type="submit"
                   name="form.button.Publish"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"
                   tal:condition="not:request/ids|nothing"/>
            <input class="standalone"
                   type="submit"
                   name="form.button.Cancel"
                   value="Cancel"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"/>
          </div>
</metal:main_macro>