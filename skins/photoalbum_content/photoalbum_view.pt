<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

  <body>

    <metal:block fill-slot="base">
      <tal:block tal:define="dummy python:request.set('disable_border', 1)"
	         tal:replace="nothing">
        Disable the tabs
      </tal:block>    
    </metal:block>


    <div metal:fill-slot="main"
         tal:define="images python:here.contentValues(spec='Photo');
                     albums python:here.contentValues(spec='Photo Album');
                     Batch python:modules['Products.CMFPlone'].Batch;
                     b_start python:request.get('b_start', 0);
                     batch python:Batch(images, 10, int(b_start), orphan=1);">
      
      <script language="javascript">
        <!--
        var newWin;
	
        function centeredWindow(url, winname) {
	w = screen.width - (screen.width * 0.25)
	h = screen.height - (screen.height * 0.25)
	windowLeft = (screen.width - w)/2;
	windowTop = (screen.height - h)/2;
	settings = '"toolbar=no,directories=no,menubar=no,scrollbars=yes,resizable=yes,status=no,width='+w+',height='+h+',left='+windowLeft+',top='+windowTop+'"';
	closeWindow();
	newWin = window.open(url, winname, settings);
	newWin.focus();
        }
	
        function closeWindow() {
	if (newWin && !newWin.closed) {
	newWin.close();
	}
        }
	-->
      </script>

      <div class="contentHeader">
        <h1 tal:content="here/title_or_id">Title or id</h1>
      </div>
      
      <div metal:use-macro="here/batch_macros/macros/navigation"></div>

      <div style="margin-top: 2em;" tal:content="here/Description" tal:condition="here/Description">
	Description
      </div>
	
      <table style="width: 100%;" tal:condition="python:albums or images">
	<tr>
	  <td>
	    <tal:block tal:condition="batch"
	      tal:repeat="image batch">
	      <span class="card" style="background: transparent; border-color: transparent; height: 130px; width:130px; margin: 0.5em;">
		<a tal:define="id python:int(b_start)+int(repeat['image'].number()-1)" tal:attributes="href string:${here/absolute_url}/photoalbum_photo_view?b_start=$id">
		  <img tal:replace="structure python:image.tag(size='thumbnail', title=image.Description())" />
		</a>
		</span>
	    </tal:block>
	  </td>
	</tr>
	<tr>
	  <td>
	    <tal:block tal:condition="albums"
	      tal:repeat="album albums">
	      <span style="width: 140px;" class="card" tal:define="images_in_album python:album.contentValues(spec='Photo');
		number_of_images python:len(images_in_album)">
		<div>
		  <a tal:condition="images_in_album" tal:attributes="href string:${album/absolute_url}/view">
		    <img tal:replace="structure python:modules['whrandom'].choice(images_in_album).tag(size='thumbnail', title=album.Description());" />
		  </a>
	          <a tal:condition="not:images_in_album" tal:attributes="href string:${album/absolute_url}/view">
	            <p style="text-align: center;">Album is empty</p>
	          </a>
		  <br/>
		  <span tal:content="structure string:<strong>${album/title_or_id}</strong><br/>$number_of_images photos in album"></span>
                </div>
              </span>
            </tal:block>
          </td>
        </tr>
      </table>

      <p tal:condition="python:not (albums or images)">This album is empty.</p>
    
    </div>

    <metal:block fill-slot="documentActions" tal:define="b_start python:request.get('b_start', 0);">
      <a href="" tal:attributes="onClick string:javascript:centeredWindow('photoalbum_slideshow?b_start=$b_start');; return false;;">
        <img tal:attributes="src string:$portal_url/image_icon.gif" alt="Start slideshow" title="Start slideshow" />
      </a>

      <a tal:condition="python:here.aq_parent.meta_type=='Photo Album'" href="" tal:attributes="href string:${here/aq_parent/absolute_url}/view;">
        <img tal:attributes="src string:$portal_url/folder_icon.gif; title string:Back to album: ${here/aq_parent/title_or_id}" alt="Back" title="Back to album" />
      </a>
    </metal:block>
    
  </body>
  
</html>

