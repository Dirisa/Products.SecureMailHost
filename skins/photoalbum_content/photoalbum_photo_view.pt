<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <body>
  
    <metal:block fill-slot="base">
      <tal:block tal:define="dummy python:request.set('disable_border', 1)"
	                     tal:replace="nothing">
        Disable the tabs
      </tal:block>    
    </metal:block>
  
    <div metal:fill-slot="main"
         tal:define="DateTime python:modules['DateTime'].DateTime;
                     images python:here.contentValues(spec='Photo');
                     Batch python:modules['Products.CMFPlone'].Batch;
                     b_start python:request.get('b_start', 0);
                     batch python:Batch(images, 1, int(b_start), orphan=1);
                     image python:batch[0];
                     prefered_size python:request.cookies.get('photoalbum_display', 'medium');
                     Iterator python:modules['Products.CMFPlone'].IndexIterator;
                     tabindex python:Iterator();">

      <script language="javascript">
        <!--
        var newWin;
	
        function centeredWindow(url, winname) {
	w = screen.width - (screen.width * 0.25)
	h = screen.height - (screen.height * 0.25)
	windowLeft = (screen.width - w)/2;
	windowTop = (screen.height - h)/2;
	settings = '"toolbar=no,directories=no,menubar=no,scrollbars=yes,resizable=yes,status=no,width='+w+',height='+h+',left='+windowLeft+',top='+windowTop+'"';
	closeWindow();
	newWin = window.open(url, winname, settings);
	newWin.focus();
        }
	
        function closeWindow() {
	if (newWin && !newWin.closed) {
	newWin.close();
	}
        }
	-->
      </script>

      <span class="right">
	<input type="button" 
	       value="Back to album" 
               class="context"
	       tal:attributes="onClick string:javascript:location.href='${request/URL1}/view?b_start=$b_start';; return false;;"/>
	<input type="button" 
	       value="Start slideshow" 
	       class="context"
	       tal:attributes="onClick string:javascript:centeredWindow('photoalbum_slideshow?b_start=$b_start');; return false;;"/>
      </span>

      <div class="contentHeader">
        <h1 tal:content="image/title_or_id">Title or id</h1>
      </div>
      
      <div metal:use-macro="here/batch_macros/macros/navigation"></div>

      <tal:block tal:define="raw_date python:image.getEXIF().get('EXIF DateTimeOriginal');">
	<div style="position: relative; top: 1.6em; left: 0.3em; color: white; background: black; width:0%; white-space: nowrap; padding: 1px;"
	     tal:condition="raw_date"
             tal:content="python:here.toPortalTime(DateTime(raw_date), long_format=1)">
	</div>
      </tal:block>
	
      <a tal:condition="image/size" tal:attributes="href string:${image/absolute_url}/view">
	<img src="#" tal:replace="structure python:image.tag(size=prefered_size)" />
      </a>
	
      <p style="margin-top: 2em;" tal:content="structure image/Description">
	Description
      </p>
            
      <div class="row">
	
	<div style="width: 3em; text-align: left;" class="label">
	  <span>Size</span>
	  
	  <div id="display_help"
	       class="help"
	       style="visibility:hidden; left:-18em;">
	    Select the size of the photos.
	  </div>
	</div>
	
	<div class="field" tal:define="displays here/getDisplays">
	  <form id="cookie" action="setDisplayCookie">
	    <input type="hidden" name="b_start:int" tal:attributes="value python:b_start or 0" />
		<select onChange="javascript:document.getElementById('cookie').submit()" 
			id="display" 
			name="display" 
			tal:attributes="tabindex tabindex/next" 
		onfocus="formtooltip('display_help', 1)" 
		onblur="formtooltip('display_help', 0)">
		<option value="original">Original size</option>
		<option tal:repeat="display displays" 
		  tal:attributes="value display/name;
		    selected python:test(prefered_size == display['name'], 'selected', '');" 
		  tal:content="display/label/title">1</option>
	      </select>
	  </form>
	</div>
	
      </div>
      
    </div>
    
  </body>
  
</html>

