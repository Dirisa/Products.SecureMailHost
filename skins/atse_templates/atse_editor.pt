<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

  <body>

    <metal:block metal:fill-slot="head_slot">
      <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/atse_styles.css" />
    </metal:block>

    <div metal:fill-slot="main">

      <metal:block tal:define="action string: Schema Editor; navig_configuration nothing">
<!--
        <span metal:use-macro="here/atse_macros/macros/collector_headline" />

-->
      </metal:block>

      <!-- portlets left side -->
      <div class="left" style="width: 25%"
           tal:define="fieldsets python:[key for key in here.atse_getSchemataNames() if not key in ['metadata', 'default']];
                       default_fieldset python: fieldsets[0];
                       global fieldset request/schemata|default_fieldset">

        <metal:block tal:condition="not: request/schemata|nothing">
          <span tal:define="dummy python: request.set('schemata', fieldsets[0])" /> 
        </metal:block>

        <tal:div metal:use-macro="here/atse_macros/macros/fieldsets" />
        <tal:div metal:use-macro="here/atse_macros/macros/fields" />
        <tal:div metal:use-macro="here/atse_macros/macros/maintenance" />
      </div>
            

      <!-- portlet right side -->
      <div class="right" style="width: 70%">

        <div class="portlet" id="atse_field_editor" tal:condition="request/field|nothing"> 
          <h5 i18n:translate="field_definition">Field definition for <b tal:content="request/field"/></h5>
          <div class="portletBody" id="atse_schema_editor_fieldeditor">

            <form action="atse_update" method="post"
                  tal:define="field python: here.atse_getField(request['field']);
                              widget python: field.widget;
                              widget_name python:field.getWidgetName()">
              <input type="hidden" name="fielddata.name:record:string" 
                     tal:attributes="value request/field|nothing" />
              <input type="hidden" name="fielddata.schemata:record:string"    
                   tal:attributes="value fieldset" />
                                                                              
              <div>
                <div class="left">
                   <tal:div metal:use-macro="here/atse_macros/macros/type" />         
                 </div>
                 <div class="left">
                   <tal:div metal:use-macro="here/atse_macros/macros/widget" />         
                 </div>
                 <div class="left">
                   <tal:div metal:use-macro="here/atse_macros/macros/size" />         
                </div>
                <div class="clear">&nbsp; </div>
           
              </div>
              <div class="clear"> </div>

              <div tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget', 'PicklistWidget', 'InAndOutWidget')">
                <span class="label" i18n:translate="vocabulary">
                  Vocabulary (Use "key|value" for passing key-value pairs 
                  or 'method:&lt;methodname&gt;')
                </span>
                <div> 
                  <textarea cols="60" rows="6"
                         name="fielddata.vocabulary:record:lines"
                         tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget', 'PicklistWidget', 'InAndOutWidget')"
                         tal:content="python: here.atse_formatVocabulary(field)"></textarea>
                </div>
              </div>

              <div>
                <span class="label" i18n:translate="default">Default</span>
                <div>
                  <input type="text" value="" size="40" 
                         name="fielddata.default:record:string"
                         tal:attributes="value python: here.atse_field_default(field)"/>
                </div>
              </div>

              <div>
                <span class="label" i18n:translate="label">Label</span>
                <div>
                  <input type="text" value="" size="40" 
                         name="fielddata.label:record:string"
                         tal:attributes="value python: field.widget.label"/>
                </div>
              </div>
            
              <div>
                <div class="left">
                  <span class="label" i18n:translate="required">Required</span >
                  <div>
                    <input type="checkbox" value="1" 
                           name="fielddata.required:record:int"
                           tal:attributes="checked field/required"/>
                  </div>
               </div>
              
                <div class="left">
                  <span class="label" i18n:translate="create_index">Create index</span>
                  <div>
                    <input type="checkbox" value="1" 
                           name="fielddata.createindex:record:int"
                           tal:attributes="checked field/createindex|nothing"/>
                  </div>
                </div>
                <div class="clear"> </div>
              </div>

              <div> 
                <div class="field">
                  <input type="submit" value="Save changes" class="standalone" i18n:attributes="value">
                </div> 
              </div>

          </form>
          </div>
        </div>

      </div>

      <div class="clear"> </div>
    </div>
  </body>
</html>
