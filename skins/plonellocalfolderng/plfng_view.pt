<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

<body>


<div metal:fill-slot="main"
     tal:define="folderfilter python:request.get('folderfilter', '');
                 global decodedFilter python:here.decodeFolderFilter(folderfilter);
                 global filterValues decodedFilter;
                 global filter decodedFilter;
                 standalone python:1;
                 valid_folder python:here.validFolder(REQUEST=request);
                 folder_contents python:here.getContents(REQUEST=request);
                 mtool mtool|here/portal_membership;
                 myfolder python:here.absolute_url()==mtool.getHomeUrl();
                 requireUploadMD5 python:here.requireUploadMD5();
                 fileUnpackingAllowed python:here.fileUnpackingAllowed();
                 errors python:request.get('errors', {})">
 
 <metal:block tal:condition="python:valid_folder==1">

    <div>
        <form name="folderContentsForm"
              method="post"
              action="folder_object"
              tal:attributes="action here/absolute_url"
              tal:define="b_start python:request.get('b_start', 0);
                          results folder_contents;
                          Batch python:modules['Products.CMFPlone'].Batch;
                          batch python:Batch(results, 100, int(b_start), orphan=0);">

                <h1 tal:condition="myfolder">
                <img tal:replace="structure here/folder.gif" />
                <span i18n:translate="heading_my_folder" tal:omit-tag="">My Folder</span>
                </h1>

                <h1 tal:condition="not:myfolder">
                  <img tal:replace="structure here/folder.gif" />
                 	<span tal:content="here/plfng_translatedpath" />
                </h1>

                <metal:block tal:condition="not: folder_contents">
                <p i18n:translate="description_no_visible_items_press_add">
                This folder has no visible items.
                </p>
                </metal:block>

                <p tal:condition="myfolder"
                      i18n:translate="description_contains_items_by">
                Contains the items created and collected by <tal:block content="python:user.getUserName()" i18n:name="name">User</tal:block>
                </p>

                <div tal:define="url string:${request/URL2}">
                  <a href="#" tal:attributes="href url" class="link-parent">Up one level</a>
                </div>
                <p tal:content="structure here/Description"
                   tal:condition="not:myfolder">
                   description
                </p>

                <!-- Navigation -->
                <div metal:use-macro="here/batch_macros/macros/navigation" />
                <metal:block define-macro="folder_listing"
                             tal:define="locked portal_object/lock_icon.gif;
                                         pencil_icon portal_object/edit.gif;
                                         use_folder_contents site_properties/use_folder_contents;
                                         filterOut here/getNotAddableTypes;
                                         filterValues decodedFilter/keys | nothing;
                                         types python:here.sortObjects(here.allowedContentTypes());
                                         no_types python:len(types);
                                         filterTypes python:test( filterValues==nothing, types, here.filterTypes(filter));
                                         isExpired nocall:here/isExpired;
                                         toPortalTime nocall:here/toPortalTime;
                                         getObjSize nocall:here/getObjSize;
                                         lock_tool here/portal_lock|nothing;
                         getInfoFor python:wtool.getInfoFor;
                                         iface_tool here/portal_interface;
                                         orderable_iface string:Products.CMFPlone.interfaces.OrderedContainer.IOrderedContainer;
                                         isOrderable python:iface_tool.objectImplements(here, orderable_iface);
                                         nosortclass python:test(isOrderable, 'nosort', '')">

                <table id="sortable"
                       class="listing"
                       summary="Content listing"
                       cellpadding="0" cellspacing="0">

                    <thead>

                        <metal:block tal:condition="folder_contents|not:standalone|nothing">
                        <tr>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_title">Title</span>&nbsp;</th>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_type">Type</span>&nbsp;</th>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_size">Size</span>&nbsp;</th>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_modified">Modified</span>&nbsp;</th>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_comment">Comment</span>&nbsp;</th>
                            <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                            i18n:translate="listingheader_action">Action</span>&nbsp;</th>
                        </tr>
                        </metal:block>
                    </thead>

                    <metal:block tal:condition="folder_contents|not:standalone|nothing">
                    <tbody>
                    <metal:block tal:repeat="item batch">
                        <tr tal:define="oddrow repeat/item/odd;
                                        item_typeinfo item/getTypeInfo"
                            tal:attributes="class python:test(oddrow, 'even', 'odd')" >

                            <td tal:define="action python:item_typeinfo.immediate_view;
                                            url item/absolute_url;">

                                <a href="#" tal:attributes="href url">

                                    <img tal:define="icon python:item.getIcon(1); iconObject python:getattr(here,icon)"
                                         tal:attributes="src string:$portal_url/$icon; alt iconObject/title_or_id"
                                    />&nbsp;<span tal:replace="item/title_or_id">Title</span>
                                </a>
                                <tal:block tal:condition="python:site_properties.ext_editor and item_typeinfo.getActionById('external_edit',None)">

                                <a href="absolute_url/external_edit"
                                   tal:attributes="href string:${item/absolute_url}/external_edit">
                                   <img tal:replace="structure python:pencil_icon.tag(title='Edit with External Editor')" />
                                 </a>

                                </tal:block>

                                <img tal:define="lockable python:hasattr(item, 'wl_isLocked')"
                                     tal:condition="python:(lockable and item.wl_isLocked()) or (lock_tool and lock_tool.isLockable(item) and lock_tool.isLockedOut(item))"
                                     tal:replace="structure python:locked.tag(title='Locked')" />

                            </td>

                            <td i18n:translate="" tal:content="python:item_typeinfo.Title()">
                            folder
                            </td>

                            <td tal:define="size python:getObjSize(item)">
                              <div tal:condition="python:item_typeinfo.Title()!='folder'"
                                tal:content="structure python:test(size, size, '&nbsp;')">
                                size
                              </div>
                              <div tal:condition="python:item_typeinfo.Title()=='folder'">
                                &nbsp;
                              </div>  
                            </td>

                            <td tal:content="python:toPortalTime(item.ModificationDate(),long_format=1)">
                            08/19/2001 03:01 AM
                            </td>

                            <td tal:content="item/getComment" />

                            <td> 
                              <div>
	                              <a tal:condition="python:item_typeinfo.Title()!='folder'"
	                                  tal:attributes="href string:${item/absolute_url}?action=download">Download</a>
	                              <a tal:condition="python:item_typeinfo.Title() == 'application/zip' and member.has_permission('Modify portal content', here) and fileUnpackingAllowed"
	                                  tal:attributes="href string:${item/absolute_url}?action=unpack">Unzip</a>
	                              <a tal:condition="python:member.has_permission('Delete objects', here) and item_typeinfo.Title()!='folder'"
	                                  tal:attributes="href string:${item/absolute_url}?action=deleteFile">Delete</a>
	                              <a tal:condition="python:member.has_permission('Delete objects', here) and item_typeinfo.Title()=='folder'"
	                                  tal:attributes="href string:${item/absolute_url}?action=deleteFolder">Delete</a>
	                              <a tal:condition="python:member.has_permission('Modify portal content', here) and item_typeinfo.Title()!='folder'"
	                                  tal:attributes="href string:${item/absolute_url}?action=editMetadata">Metadata</a>        
	                           </div>       
                            </td>
                            
                        </tr>

                    </metal:block>
                    </tbody>
                    </metal:block>

                </table>

                <table>
                  <tr>
                    <td>
                    </td>
                  </tr>
                </table>
                </metal:block>

                <!-- Navigation -->
                <div metal:use-macro="here/batch_macros/macros/navigation" />
        </form>
    </div>

	<fieldset tal:condition="python: member.has_permission('Modify portal content', here)">
	<legend>Upload File:</legend>

    <div>
         <form tal:attributes="action string:${request/URL1}/upload_file" method="post" enctype="multipart/form-data">
        
        <table width="100%">
          <tr>
	          <td width="50%" valign="top">
		          File: <span class="fieldRequired" title="Required">(Required)</span><br>
		          <input type="file" name="upload">
		          <div tal:condition="requireUploadMD5">
		             MD5 Checksum: <span class="fieldRequired" title="Required">(Required)</span>
		          </div>
		       </td>
		       <td width="50%" valign="top">
		         Comment (optional):<br>
	             <textarea name="comment" cols="40" rows="2"></textarea>
	          </td>
	       </tr>
	       <tr>   
		       <td>
					 <div class="field" 
					 	tal:define="error errors/clientMD5|nothing"
					 	tal:condition="requireUploadMD5"
					   tal:attributes="class python:test(error, 'field error', 'field')">
					   
					   <label i18n:translate="label_clientMD5">client MD5</label>
					  
						<div tal:content="error">Validation error output</div>
		            
		            <input  type="text" name="clientMD5" size="36">
		          </div>  
	          </td>
	          <td>
              <center><input type="submit" value="Upload file" ></center>
            </td>
          </tr>
        </table>
 
          
        </form>
    </div>
    
    </fieldset>

    <br/>
    
    <fieldset tal:condition="python: member.has_permission('Modify portal content', here)">
	 <legend>Create Directory:</legend>
    <div>
        <form tal:attributes="action string:${request/URL1}/create_directory" method="post">
          Directory name:
          <input type="text" name="dirname" size="30">
          &nbsp;
          <input type="submit" value="Create Directory" >
        </form>
    </div>
    
    </fieldset>
  </metal:block>
  
  <metal:block tal:condition="python: valid_folder==0">
     <p i18n:translate="description_no_visible_items_press_add">
      This folder is not accessible.  Please report this problem to the portal administrator!!
     </p>
  </metal:block>

</div>

</body>
</html>
