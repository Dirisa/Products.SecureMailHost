<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

<body>

<div metal:fill-slot="main"
     tal:define="action python:request.get('action','none')">
  <div>
    <div tal:define="folder_props  python:here.getProperties(REQUEST=request);
                     total_size    python:folder_props.get('size',0);
                     total_folders python:folder_props.get('folders',0);
                     total_files   python:folder_props.get('files',0);
                     filetypesNotToCatalog here/filetypes_not_to_catalog">
       <br>
       <b>total # files with legal id's contained by this folder = </b>
       <span tal:content="total_files">
         files
       </span>
       <br><br>
       <b>total # bytes for these files = </b>
       <span tal:content="total_size">
         size
       </span>
       <br><br>
       <b>filetypes not to catalog = </b>
       <span tal:content="filetypesNotToCatalog">
         size
       </span>
       <br><br>
       
       <fieldset tal:condition="python:action!='catalog_now'">
		 <legend>Catalog Folder Contents:</legend>
		 	This functionality depends on the TextIndexNG2 product and the proper 
		 	configuration of the ZCatalog (ie, 'portal catalog') instance.  Refer 
		 	to the README.txt for specific information on using TextIndexNG2 with
		 	this product.
		 	<br>
		 	<br>
         <center>
	         <code>
	           <a class="button" tal:attributes="href string:${request/URL1}/plfng_catalog?action=catalog_now">Catalog Contents Now</a>
	         </code>
  	      </center>

	    </fieldset>

       <div tal:condition="python:action=='catalog_now'"
            tal:define="startTime python:DateTime();">
          <div tal:define="filesCataloged python:here.catalogContents();
        							filesNotCataloged python:total_files - filesCataloged; 
        							stopTime python:DateTime();
        							elapsedTime python:(stopTime-startTime)*86400.0;">
           <hr>
           <b>total # files cataloged = </b>
           <span tal:content="filesCataloged">
             files
           </span>
           <br><br>
           <b>total # files NOT cataloged = </b>
           <span tal:content="filesNotCataloged">
             files
           </span>
           <br><br>
           <b>elapsed time = </b>
           <span tal:content="elapsedTime">
             files
           </span>
           <br><br>
           <b>average index rate = </b>
           <span tal:content="python:total_size/elapsedTime/1024.0">
             files
           </span> (KB/sec)
          </div>
       </div>   
    </div>
  </div>
</div>

</body>
</html>
