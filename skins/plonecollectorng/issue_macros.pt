
<!-- Issue related macros -->

<div metal:define-macro="issue_references">
  <div class="group"
       tal:define="references here/getRefs;
                   breferences here/getBRefs">
    <span class="legend" i18n:translate="legend_references">References</span>

      <ul>
        <li><span i18n:translate="references">References</span>
          <ul>
            <li tal:repeat="rs here/getRelationships">
              <a tal:attributes="href string:/${rs/getURL}" tal:content="string: ${rs/getCollectorTitle}:${rs/getId} (${rs/getComment})" />
              [<a tal:attributes="href string: delete_reference?issue_url=${rs/getURL}">del</a>]
            </li>
          </ul>
        </li>
        <li><span i18n:translate="referenced_by">Referenced by</span>
          <ul>
            <li tal:repeat="ref breferences">
              <metal:block  tal:define="url python: ref.absolute_url(1)">
                <a tal:attributes="href url" tal:content="ref/title_or_id" />
              </metal:block>
            </li>
          </ul>
        </li>
        <li><span i18n:translate="dependency_graph">Dependency graph</span>: 
          <a href="pcng_references_tree?format=gif">[GIF]</a>
          <a href="pcng_references_tree?format=jpeg">[JPEG]</a>
          <a href="pcng_references_tree?format=png">[PNG]</a>
          <a href="pcng_references_tree?format=svg">[SVG]</a>
          <a href="pcng_references_tree?format=ps">[PS]</a>
        </li>
      </ul>
  </div> <!-- End group -->
</div>  <!-- End macro: issue_references_table -->


<div metal:define-macro="issue_uploads">
  <div class="group">
    <span class="legend" i18n:translate="legend_uploads">Uploads</span>

        <div class="row" tal:repeat="item here/objectValues">
          <div class="label">
            <span tal:define="icon item/getIcon|item/icon|nothing">

              <span tal:condition="icon">
                <a href="" tal:attributes="href item/absolute_url">
                  <img src="" alt="" border="0"
                       tal:attributes="src python: here.portal_url() + '/' + icon;
                                       alt item/Type|nothing" />
                </a>
              </span>
              <a href="ITEM URL"
                 tal:attributes="href item/absolute_url"
                 tal:content="item/id">ITEM ID</a>

              <span tal:replace="python: '(%s, %s)' % (here.toPortalTime(item.created(),long_format=1), item.Creator())" />
              <a i18n:translate="issue_artifacts_table_info_link"
                 tal:attributes="href python:item.absolute_url() + '/view'">[Info]</a>

              <a tal:condition="python: 'TrackerAdmin' in member.getRolesInContext(here)"
                 i18n:translate="issue_artifacts_table_deletion_link"
                 tal:attributes="href string:${here/absolute_url}/upload_remove?id=${item/getId}">[Del]</a>
            </span>
             <span tal:replace="item/description"> DESCRIPTION</span>
          </div>

        </div> <!-- End row -->

        <span i18n:translate="issue_artifacts_table_no_uploads_available"
              tal:condition="not: here/objectValues">No uploads available</span>

  </div> <!-- End group -->
</div> <!-- End macro: issue_artifacts_table -->



<div metal:define-macro="add_uploads">
  <div class="group">
    <form method="post" action="upload_file" enctype="multipart/form-data">
      <span class="legend" i18n:translate="legend_artifacts_upload">Upload files or images</span>

      <div class="row">
          <div class="label">&nbsp;</div>
          <div class="field"><input type="file" name="uploaded_file" size="40"/></div>
      </div> <!-- End row -->

       <div class="row">
        <div class="label" i18n:translate="add_artifacts_table_comment">Comment</div>
        <div class="field">
          <textarea name="comment" cols="60" rows="5"></textarea>
        </div>
       </div> <!-- End row -->

       <div class="row">
        <div class="field">
          <input type="submit" value=" Upload " class="standalone">
        </div>
       </div> <!-- End row -->
    </form>
  </div> <!-- End group -->

</div>  <!-- End macro: add_artifacts_excerpt -->


<div metal:define-macro="add_references">

<script language="javascript">
function show_tickets() {
    el = document.myform["reference.tracker:record:string"];
    selected = el.selectedIndex;

    if (selected == 0) {
        return 0;
    }

    tracker = el.options[selected].value;
    url = tracker + "/pcng_issue_selection"; 
    win = open(url, "tickets", "width=500, height=600, scrollbars=yes");
}

</script>

  <div class="group">

    <span class="legend" i18n:translate="legend_new_reference_to_issue">New reference to other issue</span>
    <form method="post" action="add_reference" name="myform">

      <div class="row">
        <div class="label" i18n:translate="add_references_table_collector">
          Collector
        </div>
        <div class="field">
          <select name="reference.tracker:record:string">
            <option value="" />
            <metal:block tal:repeat="tracker python:here.superValues(('PloneCollectorNG',))">
              <option tal:attributes="value python: '/' + tracker.absolute_url(1);
                                      selected python: tracker.getId()==here.aq_parent.getId()"
                      tal:content="string: ${tracker/getId} (${tracker/title})" />

            </metal:block>
          </select>
        </div>
      </div> <!-- End row -->

      <div class="row">
        <div class="required_label" i18n:translate="add_references_table_issue_number">Issue #</div>
        <div class="field">
          <input type="text" name="reference.ticketnumber:record:string"  value="" size="5" />
          <input class="context" type="button"  onClick="javascript:show_tickets()" value="Select"
                 i18n:attributes="value" />
        </div>
      </div> <!-- End row -->

      <div class="row">
        <div class="required_label" i18n:translate="add_references_table_comment">
          Comment
        </div>
        <div class="field">
          <textarea  name="reference.comment:record:string" cols="60" rows="5"></textarea>
        </div>
      </div> <!-- End row -->

      <div class="row">
        <div class="field">
          <input type="submit" value=" Submit " class="standalone">
        </div>
      </div> <!-- End row -->
    </form>
  </div> <!-- End group -->
</div>  <!-- End macro: add_references_table -->


<div metal:define-macro="watchlist">

  <div class="group" tal:condition="python: here.wl_getMode()=='anyone' or 
                                            (here.wl_getMode()=='authenticated' and member.getUserName() != 'Anonymous User') "
       tal:define="email python: member.getProperty('email')">

    <span class="legend">Watchlist</span>


    <metal:block tal:condition="email">
      <div tal:condition="not: python: here.wl_isWatcher(email)">
        <a tal:attributes="href string:${here/absolute_url}/wl_addWatcher?email=${email}">Subscribe</a>
      </div>      
      <div tal:condition="python: here.wl_isWatcher(email)">
        <a tal:attributes="href string:${here/absolute_url}/wl_removeWatcher?email=${email}">Unsubscribe</a>
      </div>      
    </metal:block>


    <metal:block tal:condition="not: email">
      <form tal:attributes="action string:${here/absolute_url}/wl_addWatcher">
        E-Mail address:        
        <input type="text" size="30" name="email" >
        <input type="submit" value=" Subscribe to this issue " class="standalone">
      </form>
    </metal:block>

  </div>

</div>
