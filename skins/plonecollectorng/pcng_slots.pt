<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plonecollectorng">

<body>

<!-- The news box -->

<div metal:define-macro="navigation">

    <tal:if tal:condition="python: here.meta_type=='PloneIssueNG'">
      <div metal:use-macro="here/pcng_slots/macros/issue_metadata" />
    </tal:if>

    <tal:if tal:condition="python: here.meta_type=='PloneCollectorNG'">
      <div metal:use-macro="here/pcng_slots/macros/collector_metadata" />
    </tal:if>

    <div metal:use-macro="here/pcng_slots/macros/searchresults" />
</div>

<!-- searchresults -->
<div metal:define-macro="searchresults">
  <div class="portlet" id="pcng-collector-metadata"
       tal:condition="python: request.SESSION.has_key('pcng_searchresults')">
    <h5 i18n:translate="last_search_results">Last search results</h5>
    <div class="portletBody"
         tal:define="my_id here/getId;
                     results python: request.SESSION.get('pcng_searchresults', []);
                     issue_ids python: [i[1] for i in results]">
   
      <tal:if tal:condition="python: here.meta_type=='PloneIssueNG'" >
        <tal:def tal:define=" issue_index python: issue_ids.index(here.getId())">
  
          <a tal:condition="python: issue_index > 0"
             tal:attributes="href python: results[issue_index-1][0]">Previous</a>
          <a tal:condition="python: issue_index < len(results) "
             tal:attributes="href python: results[issue_index+1][0]">Next</a>
        </tal:def>
      </tal:if>

      <ul>
        <li tal:repeat="item results">
          <a tal:attributes="href python: item[0]">
            <span tal:attributes="class python: test(item[1]==my_id, 'selected', '')"
                  tal:content="python: '%s - %s' % (item[1],item[2])" />
          </a>
        </li>        
      </ul>
    </div>
  </div>
</div>

<!-- Collector metadata -->
<div metal:define-macro="collector_metadata">
  <div class="portlet" id="pcng-collector-metadata">
    <h5 i18n:translate="collector_metadata">Collector data</h5>
    <div class="portletBody">
      <ul>
      </ul>
    </div>
  </div>
</div>

<!-- Issue metadata -->
<div metal:define-macro="issue_metadata">
  <div class="portlet" id="pcng-issue-metadata">
    <h5 i18n:translate="issue_metadata">Issue data</h5>
    <div class="portletBody">
      <ul>
        <li>
            <span i18n:translate="creator">Creator</span>:
            <span tal:replace="here/Creator" />
        </li>
        <li>
            <span i18n:translate="created">Created</span>:
            <span tal:replace="python: here.toLocalizedTime(here.created())" />
        </li>
      </ul>
    </div>
  </div>
</div>

</body>
</html>
