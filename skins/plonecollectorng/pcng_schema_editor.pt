<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>

  <div metal:fill-slot="main">

    <h1 i18n:translate="heading_edit_schema">Edit schema</h1>
    <div 
	   tal:define="default_fieldset python: 'default';
                   fieldset request/fieldset|default_fieldset;
                   fieldsets python:[key for key in here.getSchemaNames() if key != 'metadata'];"
           tal:omit-tag="">
       <div tal:condition="fieldsets">  <!-- Navigation -->
         <form action="newSchema" method="post">
           <tal:block repeat="set fieldsets">
             <div tal:condition="python: set == fieldset and fieldsets != ['default']" tal:omit-tag="">
               <b>[<span tal:content="set" />]</b>
             </div>
             <div tal:condition="python: set != fieldset" tal:omit-tag="">
               <a href="#" tal:attributes="href string:${here/absolute_url}/portal_form/pcng_schema_editor?fieldset=${set}">
                  [<span tal:content="set" />]</a>

             </div>
           </tal:block>
           &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
           <input type="text" name="name" value="" size="10">
           <input type="submit" value=" Add schemata " >
           &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
           <a tal:attributes="href string:delSchema?name=${fieldset}">Delete this schemata</a>
         </form>

       </div>  <!-- EOF Navigation -->

     <form action="schema_update" method="post">
       <input type="hidden" name="fieldset" tal:attributes="value fieldset">
       <table class="listing">
         <tr>
           <th>Fieldname</th>
           <th>Type</th>
           <th>Widget</th>
           <th>Size</th>
           <th>Vocabulary</th>
           <th>Default</th>
           <th>Required</th>
           <th>Visible</th>
           <th>Action</th>
         </tr>
         <tr tal:repeat="field python: here.getSchema(fieldset).fields()" >
          <th tal:content="field/getName" />
          <td valign="top">
            <select tal:attributes="name string:${field/getName}.field:record:string">
              <span tal:repeat="item python: ('StringField', 'IntegerField', 'FloatField', 'FixedPointField', 'LinesField', 'DateTimeField', 'BooleanField')">
                <option tal:attributes="value item;
                                        selected python: item==here.schema_get_fieldtype(field)"
                        tal:content="item" />
              </span>
            </select>
          </td>

          <td valign="top">
            <select tal:attributes="name string:${field/getName}.widget:record:string">
              <option value="String" 
                      tal:content="string:String"
                      tal:attributes="selected python: field.getWidgetName()=='StringWidget'" />
              <option value="Textarea" 
                      tal:content="string:Textarea"
                      tal:attributes="selected python: field.getWidgetName()=='TextAreaWidget'" />
              <option value="Radio" 
                      tal:content="string:Radio"
                      tal:attributes="selected python: field.getWidgetName()=='SelectionWidget' and field.widget.format=='flex'"/>
              <option value="Select" 
                      tal:content="string:Select"
                      tal:attributes="selected python: field.getWidgetName()=='SelectionWidget' and field.widget.format=='select'"/>
            </select>
           </td>
          <td valign="top">
            <input type="text" value="20" size="2" 
                   tal:attributes="name string:${field/getName}.widgetsize:record:int"/>
           </td>
          <td valign="top">
            <textarea cols="40" rows="3"
                   tal:condition="python: field.getWidgetName()=='SelectionWidget'"
                   tal:attributes="name string:${field/getName}.vocabulary:record:lines"
                   tal:content="python: here.schema_format_vocabulary(field)"
             ></textarea>
           </td>
          <td valign="top">
            <input type="text" value="" size="20" 
                   tal:attributes="name string:${field/getName}.default:record:string;
                                   value field/getDefault"/>
           </td>
          <td valign="top">
            <input type="checkbox" value="1" 
                   tal:attributes="name string:${field/getName}.required:record:int;
                                   checked field/required"/>
           </td>
          <td valign="top">
            <input type="checkbox" value="1" 
                   tal:attributes="name string:${field/getName}.visible:record:int"/>
            <input type="hidden" 
                   tal:attributes="name string:${field/getName}.order:record:int;
                                   value repeat/field/index"/>
           </td>
          <td valign="top">
            <a tal:attributes="href string:schema_del_field?fieldset=${fieldset}&name=${field/getName}">Delete</a>
          </td>
         </tr>
 
         <tr> 
           <td colspan="1">
             <input type="submit" value=" Save changes ">
           </td>
         </tr>
         <tr>
           <td>&nbsp;</td> 
           <td colspan="5">
             <input type="text" name="name" value=""> <input type="submit" name="schema_add_field" value=" Add new field ">
           </td>
           <td colspan="3">
           </td>
        </tr>
       </table>
    </form>
     </div>
  </div>

</body>
</html>
