<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>
  <div metal:fill-slot="css_slot">
    <metal:define metal:use-macro="here/pcng_css/macros/stylesheet" />
  </div>
  <div metal:fill-slot="main">

    <metal:block tal:define="action string: Schema Editor">
      <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
    </metal:block>

    <table border="0" cellspacing="4" cellpadding="2"
           td tal:define="fieldsets python:[key for key in here.atse_getSchemataNames() if not key in ['metadata', 'default']];
                          default_fieldset python: fieldsets[0];
                          fieldset request/fieldset|default_fieldset; ">
      <metal:block tal:condition="not: request/fieldset|nothing">
        <span tal:define="dummy python: request.set('fieldset', fieldsets[0])" /> 
      </metal:block>

      <tr>
        <td valign="top">

          <div class="portlet" tal:condition="fieldsets">    <!-- Fieldsets -->
            <div class="padding">
            <h5 i18n:translate="schematas">Schematas</h5>
            <div class="portletBody">
              <div tal:repeat="set fieldsets">
                <a tal:content="string: ${set}" t
                   tal:attributes="href string:${here/absolute_url}/pcng_schema_editor?fieldset=${set};
                                   class python: test(set==fieldset, 'selected', '')"/>
                <a tal:attributes="href string:atse_schemtaMoveLeft?name=${set}"><img src="arrowUp.gif" title="Move up"></a> 
                <a tal:attributes="href string:atse_schemtaMoveRight?name=${set}"><img src="arrowDown.gif" title="Move down"></a> 
                <a tal:attributes="href string:atse_delSchemata?name=${set}"><img src="delete.gif" title="Delete"></a> 
              </div>
       
              <div> 
                <form action="atse_addSchemata" method="post">
                  <input type="text" name="name" value="" >
                  <input type="submit" value="Add"  class="standalone" valign="top" i18n:attributes="value">
                </form>
              </div>
            </div>
            </div>
          </div>


          <div class="portlet" tal:condition="fieldsets">    <!-- Fields -->
            <h5 i18n:translate="fields">Fields</h5>
            <div class="portletBody">  
              <div tal:repeat="field python: here.atse_getSchemata(fieldset).fields()">
                <a tal:attributes="href string:${here/absolute_url}/portal_form/pcng_schema_editor?fieldset=${fieldset}&field=${field/getName};
                                   class python: test(field.getName() == request.get('field'), 'selected', '')"
                    tal:content="string: ${field/getName}" />
                <a tal:attributes="href string:atse_fieldMoveLeft?name=${field/getName}"><img src="arrowUp.gif" title="Move up"></a> 
                <a tal:attributes="href string:atse_fieldMoveRight?name=${field/getName}"><img src="arrowDown.gif" title="Move down"></a> 
                <a tal:attributes="href string:atse_delField?name=${field/getName}"><img src="delete.gif" title="Delete"></a> 
              </div>
              <div>
                <form action="schema_update" method="post">
                  <input type="hidden" name="fielddata.schemata:record:string"    
                       tal:attributes="value request/fieldset|nothing" />
                    <input type="text" name="name" value=""> 
                    <input type="submit" name="schema_add_field" value="Add" class="standalone" i18n:attributes="value">
                </form>
              </div>
            </div>
          </div>

          <div class="portlet">
            <h5 i18n:translate="maintainance">Maintainance</h5>
            <div class="portletBody">
              <div>
                <a href="update_schema_for_issues?return_to=pcng_schema_editor" i18n:translate="update_schema_for_all_issues">Update schema for all issues</a>
              </div>
            </div>
          </div>

        </td>  <!-- EOF Navigation -->

      </tr>

    </table>

  </div>
</body>
</html>
