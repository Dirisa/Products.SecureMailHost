
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>
<div metal:fill-slot="css_slot">
  <metal:define metal:use-macro="here/pcng_css/macros/stylesheet" />
</div>
<div metal:fill-slot="main">	  

  <metal:block tal:define="action string: Followup">
      <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
  </metal:block>

  <tal:if tal:condition="request/timestamp|nothing">
   <tal:def tal:define="global quoted_followup python: here.pcng_text_followup(request['timestamp'])" />
  </tal:if>
    
  <form method="post" action="issue_followup">
    <fieldset
         tal:define="assignees here/assigned_to">
      <legend><span i18n:translate="issue_followup">Issue Followup</span> #<span tal:content="python: len(here) + 1"/></legend>

      <div class="row">
        <div class="label" i18n:translate="comment">Comment</div>
        <div class="field">
          <textarea name="comment" cols="80" rows="10" 
                    tal:content="request/comment|quoted_followup|nothing"></textarea>
        </div>
      </div>

      <table tal:define="allow_assign  python: here.pcng_user_role() in ('TrackerAdmin', 'Supporter', 'Reporter')">
        <tr>
          <th>
            <span tal:condition="allow_assign" i18n:translate="assign_to"> Assign to  </span>
          </th>
          <th>&nbsp;</th>
          <th> 
            <span i18n:translate="action">Action </span>
            (<span i18n:translate="workflow_action_current_state">Current state</span>: <span i18n:translate="" tal:content="here/status" />)</th>
        </tr>
    
        <tr>
          <td valign="top">
            <select tal:condition="allow_assign" name="assignees:list" size="7" multiple>
              <span tal:repeat="u python: here.getTrackerUsers(staff_only=1)">
                <option tal:content="string: ${u/fullname} (${u/username})"
                        tal:attributes="value u/username;
                                        selected python: u['username'] in assignees" 
                 />
              </span>
            </select>
          </td>
          <td width="200"> </td>

          <td valign="top" tal:define="actions here/validActions">
            <input type="radio" name="action" value="comment" checked>Comment
            <tal:loop tal:repeat="action actions">
              <br><input type="radio" name="action" 
                         tal:attributes="value action;
                                         CHECKED python: request.get('state','') == action"/>
              <span i18n:translate="" tal:content="action/capitalize" />
            </tal:loop>
          </td>
        </tr>
      </table>

      <div class="row">
        <div class="label">&nbsp;</div>
        <div class="field">
          <input class="context" type="submit" value="Save" i18n:attributes="value" class="standalone"/>
          <input class="context" type="reset" value="Reset" i18n:attributes="value" class="standalone"/>
        </div>
      </div> <!-- End row -->

    </fieldset> 
  </form>
</div>
</body>
</html>
