
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>
  <div metal:fill-slot="css_slot">
    <metal:define metal:use-macro="here/pcng_css/macros/stylesheet" />
  </div>
  <div metal:fill-slot="main">

    <metal:block tal:define="action string: Search form editor">
      <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
    </metal:block>

    <form action="pcng_view" method="GET"  name="search_form" 
          tal:define="schema here/atse_getSchema">
    <table tal:define="settings here/getSearchForm" >
      <tr>
        <tal:loop tal:repeat="item python: here.getSearchForm().keys()">
          <th tal:condition="python: settings[item]['mode'] == 'selectwidget'">
            <tal:if tal:condition="python: schema.has_key(item)">
              <tal:def tal:define="field python: schema[item]" >
                <span class="schemata_label" i18n:translate="" tal:content="python: field.widget.Label(here).strip()" />
              </tal:def>
            </tal:if>
            <tal:if tal:condition="not: python: schema.has_key(item)">
              <span class="schemata_label" tal:content="item" i18n:translate=""/>
            </tal:if>
          </th>
        </tal:loop>
      </tr>

      <tr>
        <tal:loop tal:repeat="item python: settings.keys()">
          <td tal:condition="python: settings[item]['mode'] == 'selectwidget'" >
            <select tal:attributes="name item" multiple size="5">
              <tal:loop tal:repeat="entry python: here.pcng_uniquevalsFor(item)" >
                <option tal:attributes="value entry" tal:content="entry" />
              </tal:loop>
            </select>
          </td>
        </tal:loop>
      </tr>
    </table>

    <table tal:define="settings here/getSearchForm">
      <tal:loop tal:repeat="item python: settings.keys()">
        <tr tal:condition="python: settings[item]['mode'] == 'stringwidget'" >
          <th>
            <tal:if tal:condition="python: schema.has_key(item)"
                    tal:define="field python: schema[item]">
              <span class="schemata_label" i18n:translate="" tal:content="python: field.widget.Label(here).strip()" />:
            </tal:if>
            <tal:if tal:condition="not: python: schema.has_key(item)">
              <span class="schemata_label" tal:content="item" i18n:translate=""/>
            </tal:if>
          </th>
          <td colspan="3">
            <input type="text" tal:attributes="name item" value="" size="30">
            <span tal:content="python: here.pcng_getIndexTypeFor(item)" />
          </td>
        </tr>
      </tal:loop>

      <tr>
        <th>
          <span i18n:translate="fulltextsearch">Fulltext search</span>
        </th>
        <td colspan="3">
          <input type="text" name="SearchableText" value="" size="30" tal:attributes="value request/SearchableText|nothing">
        </td>
      </tr>

      <tr>
        <th align="left" i18n:translate="sorting">Sorting</th>

        <td align="center" valign="top" colspan="2">
          <select name="sort_on" size="1">
            <option i18n:translate=""
                    tal:repeat="item python: (
                          ('getId','Issue'),
                          ('creation_date','Date'),
                          ('progress_deadline','Deadline'),
                          ('Creator','Submitter'),
                          ('progress','Progress'),
                          ('classification','Classification'),
                          ('status','Status'),
                          ('Title','Title') ,
                          ('topic','Topic'),
                          ('importance','Importance')
                          )"
                     tal:attributes="value python: item[0];
                                     selected python: request.get('sort_on', 'getId') == item[0]"
                     tal:content="python: item[1]" />
          </select> 

          <select name="sort_direction" size="1">
            <option i18n:translate=""
                    tal:repeat="item python: (
                          ('desc','Desc'),
                          ('asc','Asc'),
                          )"
                     tal:attributes="value python: item[0];
                                     selected python: request.get('sort_direction', 'desc') == item[0]"
                     tal:content="python: item[1]" />
          </select> 
        </td>
            
        <th i18n:translate="hits_per_page">Hits per page</th>

        <td align="center" valign="top">                      
          <select name="batchsize:int" size="1">
            <option i18n:translate=""
                    tal:repeat="item python: (
                          (10,10),
                          (25,25),
                          (50,50),
                          (100,100),
                          (250,250),
                          (500,500)
                          )"
                     tal:attributes="value python: item[0];
                                     selected python: request.get('batchsize', 10) == item[0]"
                     tal:content="python: item[1]" />
          </select> 
        </td>
      </tr>

      <tr>
        <td colspan="3">
          <input type="submit" value="Search" i18n:attributes="value" class="standalone">
        </td>
      </tr>
    </table>
    </form>

  </div>
</body>
</html>
