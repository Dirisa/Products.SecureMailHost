<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plonecollectorng"
      metal:use-macro="here/main_template/macros/master">
  <body>

    <metal:block metal:fill-slot="head_slot">
	  <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/pcng_styles.css" />
    </metal:block>

    <div metal:fill-slot="main">


      <!-- set the view mode based on the collector preferences -->

      <metal:block tal:condition="not: request/mode|nothing">
        <metal:block tal:define="global mode python: member.getProperty('pcng_default_view') or 'simple'" />
      </metal:block>
      <metal:block tal:condition="request/mode|nothing">
        <metal:block tal:define="global mode request/mode" />
      </metal:block>

      <metal:block tal:define="action string: View">
        <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
      </metal:block>

      <fieldset style="border: 0">

        <div style="float: left; width: 50%; vertical-align: top"
             tal:define="schematas here/Schemata;
                         schemata_names here/SchemataNames;
                         default_fieldset python:  schemata_names[0];
                         fieldset request/fieldset|options/fieldset|default_fieldset;
                         fieldsets python:[key for key in schemata_names if key != 'metadata' and key != 'default'];" >

          <metal:block tal:condition="python: member.has_permission('ManagePortalContent', here)" >
            <span i18n:translate="edit_fieldsets">Edit fieldsets</span>: 
            <tal:block repeat="set fieldsets">
              <a href="#" tal:attributes="href string:${here/absolute_url}/pcng_base_edit?fieldset=${set}">
                 <span i18n:translate="" tal:content="set" /></a> <span tal:condition="not: repeat/set/end">&bull;</span>
            </tal:block>
          </metal:block>
        </div>

        <div style="float: right; width: 50%; vertical-align: top; text-align: right">
          <a tal:condition="python: mode in ('full', 'fullimages')"  href="pcng_issue_view?mode=simple">
            <span i18n:translate="simpleview">Simple view</span> &bull;
          </a> 
          <a tal:condition="python: mode in ('simple', 'fullimages')" href="pcng_issue_view?mode=full">
            <span i18n:translate="fullview">Full view </span> &bull;
          </a> 
          <a tal:condition="python: mode in ('simple', 'full')" href="pcng_issue_view?mode=fullimages">
            <span i18n:translate="fullview_with_images">Full view with images</span> &bull;
          </a> 
          <a tal:condition="here/haveReportlab" href="asPDF"><img src="pdflogo.gif" border="0" title="PDF"></a>
        </div>
      </fieldset>

      <fieldset tal:define="fieldset python: 'issuedata'">
        <legend><a class="schemata_legend"  
                   tal:attributes="href string:pcng_base_edit?fieldset=${fieldset}"  
                   i18n:translate=""
                   tal:content="fieldset" /></legend>

        <div style="float: left; width: 30%; vertical-align: top">
          <metal:block tal:repeat="field python: here.atse_getSchemata('issuedata').fields()">
            <metal:block tal:condition="python: field.getName() not in ('title', 'description', 'solution')">
              <div>
                <span tal:omit-tag="" metal:use-macro="here/issue_macros/macros/field_shortview" />
              </div>
            </metal:block>
          </metal:block>
          <span class="schemata_label" i18n:translate="status">Status</span>: 
          <span class="field" i18n:translate="" tal:content="python: here.pcng_format_status(here.status())" />
          <br>
          <span class="schemata_label" i18n:translate="assigned_to">Assigned to</span>: <span class="field" tal:content="python: ', '.join(here.assigned_to(sorted=1))" />
        </div>

        <div style="float: right; width: 70%; vertical-align: top;">
          <metal:block tal:repeat="field python: here.atse_getSchemata('issuedata').fields()">
            <metal:block tal:condition="python: field.getName() in ('title', 'description', 'solution')">
              <div class="row" tal:condition="python: getattr(here, field.getName())" >
                <span class="schemata_label" i18n:translate="" tal:content="python: field.widget.Label(here).strip()" />:
                <div class="issue_metadata">
                    <span metal:use-macro="python: here.widget(field.getName(), mode='view', use_label=0)"/>
                </div>
              </div>
            </metal:block> 
          </metal:block> 
        </div>
      </fieldset>


      <metal:block tal:condition="python: mode.startswith('full')" >
        <metal:block tal:repeat="schemata_name python: here.atse_getSchemataNames()">
          <metal:block tal:define="schemata python:here.atse_getSchemata(schemata_name)">
            <metal:block tal:condition="python: schemata_name not in ('default', 'issuedata') "> 
              <div metal:use-macro="here/issue_macros/macros/view_schemata" />
            </metal:block>
          </metal:block>
        </metal:block>
      </metal:block>

      <metal:block tal:omit-tag="" tal:define="uploads here/objectValues" >
        <fieldset tal:condition="uploads">
          <legend i18n:translate="uploads">Uploads</legend>
          <div>
            <metal:block tal:repeat="item uploads">
              <a tal:attributes="href item/absolute_url" tal:content="item/getId"/> 
                <span tal:condition="not: repeat/item/end">&bull;</span>   
            </metal:block>
          </div>
        </fieldset>
      </metal:block>

      <metal:block tal:omit-tag="" tal:define="references here/getForwardReferences">
        <fieldset tal:condition="references">
          <legend i18n:translate="references">References</legend>
          <div>
            <metal:block tal:repeat="ref references">
              <a tal:define="target ref/getTargetObject"
                 tal:attributes="href target/absolute_url" tal:content="string: ${ref/collector_title|nothing}: ${target/title_or_id}"/>
              <span tal:condition="not: repeat/ref/end">&bull;</span>   
            </metal:block>
          </div>
        </fieldset>
      </metal:block>


      <fieldset><legend i18n:translate="transcript">Transcript</legend>
        <div metal:use-macro="here/pcng_macros/macros/transcript_plain" /> 
      </fieldset>

      <metal:block tal:condition="python: mode.startswith('full')" >

        <metal:block tal:condition="python: mode == 'fullimages'" >
          <metal:block tal:repeat="image python: here.objectValues(('Portal Image',))">
            <img tal:attributes="src image/absolute_url">
          </metal:block>
        </metal:block>

        <div metal:use-macro="here/issue_macros/macros/watchlist" /> 

        <div metal:use-macro="here/issue_macros/macros/issue_references" /> 

      </metal:block>

    </div>
  </body>
</html>
