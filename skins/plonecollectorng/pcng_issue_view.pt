<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plonecollectorng"
      metal:use-macro="here/main_template/macros/master">
  <body>

    <div metal:fill-slot="css_slot">
      <metal:define metal:use-macro="here/pcng_css/macros/stylesheet" />
    </div>


    <div metal:fill-slot="main">

      <metal:block tal:define="action string: View">
        <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
      </metal:block>

      <!-- set the view mode based on the collector preferences -->
      <metal:block tal:condition="not: python: request.has_key('mode')">
        <tal:def tal:define="dummy python: request.set('mode', here.ui_default_issue_view)" />
      </metal:block>

      <a tal:condition="python: request.get('mode', 'simple') == 'simple'" href="pcng_issue_view?mode=full">Full view</a>
      <a tal:condition="python: request.get('mode', 'simple') != 'simple'"  href="pcng_issue_view?mode=simple">Simple view</a>

      <fieldset tal:repeat="fieldset python: ('issuedata',)">
        <legend><a class="schemata_legend"  
                   tal:attributes="href string:portal_form/pcng_base_edit?fieldset=${fieldset}"  
                   tal:content="fieldset" /></legend>
        <metal:block tal:repeat="fieldname python: ('title', 'description', 'solution')" >
          <div class="row" tal:condition="python: getattr(here, fieldname)" >
	        <span metal:use-macro="python: here.widget(fieldname, mode='view', use_label=1)"/>
          </div>
        </metal:block> 
        
        <metal:block tal:repeat="field python: here.schema_getSchema('issuedata').fields()">
          <metal:block tal:condition="python: field.getName() not in ('title', 'description', 'solution')">
          <div metal:use-macro="here/issue_macros/macros/field_shortview" />
        </metal:block>
        </metal:block>

        <span class="schemata_label" i18n:translate="status">Status: </span><span class="field" tal:content="python: here.pcng_format_status(here.status())" />&nbsp;&nbsp;
        <span class="schemata_label" i18n:translate="assigned_to">Assigned to: </span><span class="field" tal:content="python: ', '.join(here.assigned_to(sorted=1))" />
      </fieldset>


      <metal:block tal:condition="python: request.get('mode', 'simple') == 'full'" >
        <metal:block tal:repeat="schemata_name python: here.schema_getNames()">
          <metal:block tal:define="schemata python:here.schema_getSchema(schemata_name)">
            <metal:block tal:condition="python: schemata_name not in ('default', 'issuedata') "> 
              <div metal:use-macro="here/issue_macros/macros/view_schemata" />
            </metal:block>
          </metal:block>
        </metal:block>
      </metal:block>

      <div tal:define="uploads here/objectValues" >
        <fieldset tal:condition="uploads">
          <legend i18n:translate="uploads">Uploads</legend>
            <metal:block tal:repeat="item uploads">
              <a tal:attributes="href item/absolute_url" tal:content="item/getId"/>&nbsp; &nbsp;
            </metal:block>
        </fieldset>
      </div>

      <fieldset><legend i18n:translate="transcript">Transcript</legend>
        <div metal:use-macro="here/pcng_macros/macros/transcript_plain" /> 
      </fieldset>

      <metal:block tal:condition="python: request.get('mode', 'simple') == 'full'" >

        <metal:block tal:repeat="image python: here.objectValues(('Portal Image',))">
          <img tal:attributes="src image/absolute_url">
        </metal:block>

        <div metal:use-macro="here/issue_macros/macros/watchlist" /> 

        <div metal:use-macro="here/issue_macros/macros/issue_references" /> 

      </metal:block>

    </div>
  </body>
</html>
