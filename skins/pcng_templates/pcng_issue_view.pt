<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plonecollectorng"
      metal:use-macro="here/main_template/macros/master">
  <body>

    <metal:block metal:fill-slot="head_slot">
	  <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/pcng_styles.css" />
      <tal:check tal:define="dummy context/pcng_check_access" />
    </metal:block>

    <div metal:fill-slot="main">

      <!-- The evil in person -->
      <tal:call> 
        <span tal:define="dummy here/setDefaults" />
      </tal:call>

      <!-- set the view mode based on the collector preferences -->

      <metal:block tal:condition="not: request/mode|nothing">
        <metal:block tal:define="global mode python: member.getProperty('pcng_default_view') or 'simple'" />
      </metal:block>
      <metal:block tal:condition="request/mode|nothing">
        <metal:block tal:define="global mode request/mode" />
      </metal:block>

      <metal:block tal:define="action string: View">
        <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
      </metal:block>

      <div tal:condition="python: here.getPortlet_issuedata() == 'inline'">
          <metal:div metal:use-macro="here/pcng_portlet_macros/macros/issuedata" />
      </div>


      <div style="clear: both"  id="issue_description_solution"
           tal:define="schema python: here.atse_getSchemata('PloneIssueNG', 'issuedata')">
        <tal:def tal:define="field python: schema['description']" >
          <div class="row" tal:condition="python: field and getattr(here, field.getName())" >
            <span id="label_large" i18n:translate="" tal:content="python: field.widget.Label(here).strip()" />:
            <pre class="issue_metadata" tal:content="python: here.format_pre('description')" />
          </div>
        </tal:def>

        <tal:def tal:define="field python: schema['solution']" >
          <div class="row" tal:condition="python: field and getattr(here, field.getName())" >
            <span id="label_large" i18n:translate="" tal:content="python: field.widget.Label(here).strip()" />:
            <pre class="issue_metadata"><span metal:use-macro="python: here.widget(field.getName(), mode='view', use_label=0)"/>
            </pre>
          </div>
        </tal:def>
      </div>

      <div id="issue_transcript">
        <span id="label_large" i18n:translate="transcript">Transcript</span>
        <br/>
        <div metal:use-macro="here/pcng_macros/macros/transcript_comments" /> 
        <br/>
        <br/>
        <span id="label_large" i18n:translate="changes">Changes</span>
        <br/>
        <div metal:use-macro="here/pcng_macros/macros/transcript_changes" /> 
      </div>

      <fieldset tal:condition="python: mode == 'full'" 
                tal:define="images python: here.objectValues(('Portal Image',))">
        <legend i18n:translate="images">Images</legend>
        <div tal:repeat="image images">
          <span tal:content="image/getId" />:<br/>
          <img tal:attributes="src image/absolute_url">
          <br/>
        </div>
        <div tal:condition="not: images">
          <span i18n:translate="no_images">No images available</span>
        </div> 
      </fieldset>

      <metal:block tal:condition="python: mode=='full'" >
        <div metal:use-macro="here/issue_macros/macros/watchlist" /> 
      </metal:block>

      <metal:div metal:use-macro="here/pcng_macros/macros/copyright" />
    </div>
  </body>
</html>
