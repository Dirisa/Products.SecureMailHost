<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>
<metal:block metal:fill-slot="head_slot">
  <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/pcng_styles.css" />
</metal:block>
<div metal:fill-slot="main">	  

  <metal:block tal:define="action string: Staff; navig_configuration nothing">
    <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
    <tal:check tal:define="dummy context/pcng_check_access" />
  </metal:block>

  <form action="set_staff" method="post">
      <table class="listing" 
             tal:define="user_obj here/getUsers;
                         topic_obj here/getTopics;
                         users user_obj/getUsers;
                         supporters users/supporter|python: [];
                         reporters users/reporter|python: [];
                         managers users/manager|python: []">
        <tr>
          <th i18n:translate="UserID">User ID</th>
          <th i18n:translate="Name">Name</th>
          <th i18n:translate="Email">Email</th>
          <th i18n:translate="Managers">Administrator</th>
          <th i18n:translate="Supporter">Supporter</th>
          <th i18n:translate="Reporter">Reporter</th>
          <th i18n:translate="topic_groups">Topic groups</th>
          <th i18n:translate="gruf_groups">GRUF groups</th>
          <th i18n:translate="group_members">Group members</th>
        </tr>

        <span tal:repeat="item python: (('Assigned', here.pcng_tool.getTrackerUsers(staff_only=1,with_groups=1)),
                                        ('Unassigned', here.pcng_tool.getTrackerUsers(unassigned_only=1,with_groups=1)))">
          <span tal:define="headline python: item[0]; users python: item[1]" >
            <tr>
              <th class="staff" colspan="9" i18n:translate="" tal:content="headline" />
            </tr>
            <span tal:repeat="user users" >
          
              <tr class="odd" tal:attributes="class python:test(repeat['user'].even(), 'even', 'odd')">
                <td>
                  <tal:def tal:condition="not: python: user['username'].startswith('group')">
                    <a tal:attributes="href string:$portal_url/prefs_user_details?userid=${user/username}"   
                       tal:content="user/username"/>
                   </tal:def>
                  <tal:def tal:condition="python: user['username'].startswith('group')" >
                    <em><a tal:attributes="href string:$portal_url/prefs_group_members?groupname=${user/username}"   
                       tal:content="python: '%s (Group)' % user['username'][6:]"/>
                    </em>
                  </tal:def>
                </td>
                <td tal:content="user/fullname|nothing" />
                <td tal:content="user/email|nothing" />
                <td style="text-align: center">
                  <input type="checkbox" name="managers:list:string" 
                         tal:attributes="value user/username;
                                         checked python: user['username'] in managers" />
                </td>
                <td style="text-align: center">
                  <input type="checkbox" name="supporters:list:string" 
                         tal:attributes="value user/username;
                                         checked python: user['username'] in supporters" />
                </td>
                <td style="text-align: center">
                  <input type="checkbox" name="reporters:list:string" 
                         tal:attributes="value user/username;
                                         checked python: user['username'] in reporters" />
                </td>
                <td>
                  <span tal:replace="structure python: ' &bull; '.join(topic_obj.getTopicsForUser(user['username']) or [])" />
                </td>
                <td>
                  <span tal:replace="structure python: ' &bull; '.join(here.pcng_get_groups_for_user(user['username']))" />
                </td>
                <td>
                  <span tal:condition="python: user['username'].startswith('group')"   
                        tal:content="python: ', '.join(here.pcng_get_group_members(user['username']))"/>
                </td>
              </tr>
            </span>
            <tr tal:condition="not: users">
              <td colspan="9">
                <span i18n:translate="no_users_found">No users found</span>
              </td>
            </tr>
          </span>
        </span>
      </table>

       <div class="formHelp" i18n:translate="help_staff" style="text-align: left">
         <b>Collector administors</b> are responsible for the configuration and the
         maintainance of a collector
         <br>
         <b>Supporters</b> work on issues. Usually issues are assigned to a supporter
         in order to resolve the issue.
         <br>
         <b>Reporters</b> file new issues and have only limited rights on an issue
         after the issue has been filed.
       </div>

      <div class="row">
        <div class="label">&nbsp;</div>
        <div class="field">
          <input class="context" type="submit" value="Save" i18n:attributes="value" class="standalone"/>
          <input class="context" type="reset" value="Reset" i18n:attributes="value" class="standalone"/>
        </div>
      </div> <!-- End row -->

  </form>
</div>
</body>
</html>
