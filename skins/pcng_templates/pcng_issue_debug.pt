<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plonecollectorng"
      metal:use-macro="here/main_template/macros/master">
  <body>

    <metal:block metal:fill-slot="head_slot">
	  <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/pcng_styles.css" />
    </metal:block>

    <div metal:fill-slot="main">

      <metal:block tal:define="action string: Debug">
        <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
      </metal:block>

      <h3>Misc.</h3>
      <ul>
        <li>Status: <span tal:content="here/status" />
        <li>Current user: <span tal:content="member"/>
        <li>Roles: <span tal:content="python: member.getRolesInContext(here)" />
      </ul>
        

      <h3>Workflow history</h3>
      <ul tal:define="wf_history here/getWorkflowHistory">
        <li tal:repeat="wf wf_history/keys" >
          <span  tal:content="wf" />
          <ul>
            <li tal:repeat="item python: wf_history.get(wf)" tal:content="item" />
          </ul>
        </li>
      </ul>


      <h3>Email</h3>
      <tal:loop tal:repeat="lang python: ['en'] + here.getLanguages()">
        <a tal:attributes="href string:pcng_issue_debug?pcng_language=${lang}" 
           tal:content="lang" />
        <span tal:condition="not: repeat/lang/end">&bull;</span>
      </tal:loop>
      <pre tal:content="python: here.format_transcript(request.get('pcng_language', 'en')).encode(here.getSiteEncoding())" />


      <h3>Archetypes</h3>
      <table border="1">
        <tr tal:repeat="field python: here.Schema().fields()">
          <td> 
            <span tal:content="field/getName" />
          </td>
          <td>
            <span tal:content="python: here.getField(field.getName()).get(here)" />
          </td>
          <td>
            <span tal:content="python: field.mode" />
          </td>
          <td>
            <span tal:content="python: field.read_permission" />
          </td>
          <td>
            <span tal:content="python: field.write_permission" />
          </td>
        </tr>
      </table>


      <h3>Misc.</h3>
      <ul>
        <li>
          <a tal:attributes="href string:pcng_remove_issue?id=${here/getId}">
            <span i18n:translate="remove_this_issue">Remove this issue</span>
          </a>
        </li>
      </ul>

      <h3>XML</h3>
      <pre tal:content="context/pcng_issue_xml" />

    </div>
  </body>
</html>
