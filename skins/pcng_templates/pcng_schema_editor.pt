<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonecollectorng">

<body>

  <metal:block metal:fill-slot="head_slot">
    <link rel="Stylesheet" type="text/css" tal:attributes="href string:$portal_url/pcng_styles.css" />
  </metal:block>

  <div metal:fill-slot="main">

    <metal:block tal:define="action string: Schema Editor">
      <span metal:use-macro="here/pcng_macros/macros/collector_headline" />
    </metal:block>

    <a href=""
       class="link-parent"
       tal:attributes="href string:pcng_configuration"
       i18n:translate="label_up_to_configuration ">
    Up to PloneCollectorNG configuration preferences
    </a>

    <table border="0" cellspacing="4" cellpadding="2"
           td tal:define="fieldsets python:[key for key in here.atse_getSchemataNames() if not key in ['metadata', 'default']];
                          default_fieldset python: fieldsets[0];
                          fieldset request/schemata|default_fieldset; ">
      <metal:block tal:condition="not: request/schemata|nothing">
        <span tal:define="dummy python: request.set('schemata', fieldsets[0])" /> 
      </metal:block>

      <tr>
        <td valign="top">

          <div class="portlet" tal:condition="fieldsets">    <!-- Fieldsets -->
            <div class="padding">
            <h5 i18n:translate="schematas">Schematas</h5>
            <div class="portletBody">
              <div class="row" style="clear: both" tal:repeat="set fieldsets">
                <div style="clear:both">
                  <div style="float:left">
                 <a tal:content="string: ${set}" t
                     tal:attributes="href string:${here/absolute_url}/pcng_schema_editor?schemata=${set};
                                     class python: test(set==fieldset, 'selected', '')"/>
                  </div>
                  <div style="float:right">
                    <a tal:attributes="href string:atse_schemataMoveLeft?name=${set}"><img src="arrowUp.gif" title="Move up"></a> 
                    <a tal:attributes="href string:atse_schemataMoveRight?name=${set}"><img src="arrowDown.gif" title="Move down"></a> 
                    <a tal:attributes="href string:atse_delSchemata?name=${set}"><img src="delete.gif" title="Delete"></a> 
                  </div>
                </div>
              </div>
       
              <div style="clear: both" >
                <form action="atse_addSchemata" method="post">
                  <input type="text" name="name" value="" >
                  <input type="submit" value="Add"  class="standalone" valign="top" i18n:attributes="value">
                </form>
              </div>
            </div>
            </div>
          </div>


          <div class="portlet" tal:condition="fieldsets">    <!-- Fields -->
            <h5 i18n:translate="fields">Fields</h5>
            <div class="portletBody">  
              <div style="clear:both" tal:repeat="field python: here.atse_getSchemata(fieldset).fields()">
                <div style="float: left">
                  <a tal:attributes="href string:${here/absolute_url}/pcng_schema_editor?schemata=${fieldset}&field=${field/getName};
                                     class python: test(field.getName() == request.get('field'), 'selected', '')"
                      tal:content="string: ${field/getName}" />
                </div>
                <div style="float: right">
                  <a tal:attributes="href string:atse_fieldMoveLeft?name=${field/getName}"><img src="arrowUp.gif" title="Move up"></a> 
                  <a tal:attributes="href string:atse_fieldMoveRight?name=${field/getName}"><img src="arrowDown.gif" title="Move down"></a> 
                  <a tal:attributes="href string:atse_delField?name=${field/getName}"><img src="delete.gif" title="Delete"></a> 
                </div>
              </div>
              <div style="clear: both">
                <form action="atse_update" method="post">
                  <input type="hidden" name="fielddata.schemata:record:string"    
                       tal:attributes="value fieldset" />
                    <input type="text" name="name" value=""> 
                    <input type="submit" name="add_field" value="Add" class="standalone" i18n:attributes="value">
                </form>
              </div>
            </div>
          </div>

          <div class="portlet">
            <h5 i18n:translate="maintenance">Maintenance</h5>
            <div class="portletBody">
              <div>
                <a href="update_schema_for_issues?return_to=pcng_schema_editor" i18n:translate="update_schema_for_all_issues">Update schema for all issues</a>
              </div>
            </div>
          </div>

        </td>  <!-- EOF Navigation -->


        <td valign="top" tal:condition="request/field|nothing">  <!-- field editor -->

          <div class="portlet">
            <h5 i18n:translate="field_definition">Field definition for <b tal:content="request/field"/></h5>
            <div class="portletBody">

          <form action="atse_update" method="post"
                tal:define="field python: here.atse_getField(request['field']);
                            widget python: field.widget;
                            widget_name python:field.getWidgetName()">
            <input type="hidden" name="fielddata.name:record:string" 
                   tal:attributes="value request/field|nothing" />
            <input type="hidden" name="fielddata.schemata:record:string"    
                   tal:attributes="value fieldset" />
        
            <table><tr>
              <td>

                <div class="row">
                  <div class="label" i18n:translate="type">Type</div>
                  <div class="field">
                    <select name="fielddata.type:record:string">
                      <span tal:repeat="item python: ('StringField', 'IntegerField', 'FloatField', 'FixedPointField', 'LinesField', 'DateTimeField', 'BooleanField')">
                        <option tal:attributes="value item;
                                                selected python: item==here.atse_getFieldType(field)"
                                tal:content="item" />
                      </span>
                    </select>
                  </div>
                </div>
              </td>

              <td>
                <div class="row">
                  <div class="label" i18n:translate="widget">Widget</div>
                  <div class="field">

                    <select name="fielddata.widget:record:string">
                      <option value="String" 
                              tal:content="string:String"
                              tal:attributes="selected python: widget_name=='StringWidget'" />
                      <option value="Textarea" 
                              tal:content="string:Textarea"
                              tal:attributes="selected python: widget_name=='TextAreaWidget'" />
                      <option value="Radio" 
                              tal:content="string:Radio"
                              tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='radio'"/>
                      <option value="Select" 
                              tal:content="string:Select"
                              tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='select'"/>
                      <option value="Flex" 
                              tal:content="string:flexible Selection"
                              tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='flex'"/>
                      <option value="Lines" 
                              tal:content="string:Lines"
                              tal:attributes="selected python: widget_name=='LinesWidget' "/>
                      <option value="Calendar" 
                              tal:content="string:Calendar"
                              tal:attributes="selected python: widget_name=='CalendarWidget' "/>
                      <option value="Boolean" 
                              tal:content="string:Boolean"
                              tal:attributes="selected python: widget_name=='BooleanWidget' "/>
                      <option value="MultiSelect" 
                              tal:content="string:MultiSelect"
                              tal:attributes="selected python: widget_name=='MultiSelectionWidget' "/>


                      <option value="Richtext" 
                              tal:content="string:Richtext"
                              tal:attributes="selected python: widget_name=='RichWidget' "/>
                      <option value="Password" 
                              tal:content="string:Password"
                              tal:attributes="selected python: widget_name=='PasswordWidget' "/>
                      <option value="Visual" 
                              tal:content="string:Visual"
                              tal:attributes="selected python: widget_name=='VisualWidget' "/>
                      <option value="Epoz" 
                              tal:content="string:Epoz"
                              tal:attributes="selected python: widget_name=='EpozWidget' "/>

                      <tal:comment tal:replace="nothing">
                          <option value="Image" 
                                  tal:content="string:Image"
                                  tal:attributes="selected python: widget_name=='ImageWidget' "/>
                          <option value="Integer" 
                                  tal:content="string:Integer"
                                  tal:attributes="selected python: widget_name=='IntegerWidget' "/>
                          <option value="Decimal" 
                                  tal:content="string:Decimal"
                                  tal:attributes="selected python: widget_name=='DecimalWidget' "/>
                          <option value="Reference" 
                                  tal:content="string:Reference"
                                  tal:attributes="selected python: widget_name=='ReferenceWidget' "/>
                          <option value="Keywords" 
                                  tal:content="string:Keywords"
                                  tal:attributes="selected python: widget_name=='KeywordWidget' "/>
                      </tal:comment>

                    </select>
                  </div>
                </div>
              </td>

              <td>
                <div class="row">
                  <div class="label" i18n:translate="size">Size</div>
                  <div class="field">
                    
                    <metal:block tal:condition="python: widget_name in ('TextAreaWidget', 'LinesWidget')">
                      <metal:block tal:condition="python: hasattr(widget, 'rows')">       
                        <span i18n:translate="rows">Rows</span>
                        <input type="text" size="3" name="fielddata.widgetrows:record:int" 
                               tal:attributes="value widget/rows|string:10"/>
                      </metal:block>
                      <metal:block tal:condition="python: hasattr(widget, 'cols')">       
                        <br>
                        <span i18n:translate="cols">Cols</span>
                        <input type="text" size="3" name="fielddata.widgetcols:record:int" 
                               tal:attributes="value widget/cols|string:60"/>
                      </metal:block>
                    </metal:block>

                    <metal:block tal:condition="not: python: widget_name in ('TextAreaWidget', 'LinesWidget')">
                        <span i18n:translate="size">Size</span>
                        <input type="text" size="3" name="fielddata.widgetsize:record:int" 
                               tal:attributes="value widget/size|string:60"/>
                    </metal:block>
                  </div>
                </div>
              </td>
            </tr></table>


            <div class="row" tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget')">
              <div class="label" i18n:translate="vocabulary">Vocabulary (Use "key|value" for passing key-value pairs or 'method:&lt;methodname&gt;')</div>
              <div class="field">
                <textarea cols="60" rows="6"
                       name="fielddata.vocabulary:record:lines"
                       tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget')"
                       tal:content="python: here.atse_formatVocabulary(field)"></textarea>
              </div>
            </div>

            <div class="row">
              <div class="label" i18n:translate="default">Default</div>
              <div class="field">
                <input type="text" value="" size="40" 
                       name="fielddata.default:record:string"
                       tal:attributes="value field/getDefault"/>
              </div>
            </div>

            <div class="row">
              <div class="label" i18n:translate="label">Label</div>
              <div class="field">
                <input type="text" value="" size="40" 
                       name="fielddata.label:record:string"
                       tal:attributes="value python: field.widget.label"/>
              </div>
            </div>
            
            <table>
              <tr>
                <td>
                  <div class="row">
                    <div class="label" i18n:translate="required">Required</div>
                    <div class="field">
                      <input type="checkbox" value="1" 
                             name="fielddata.required:record:int"
                             tal:attributes="checked field/required"/>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="row">
                    <div class="label" i18n:translate="create_index">Create index</div>
                    <div class="field">
                      <input type="checkbox" value="1" 
                             name="fielddata.createindex:record:int"
                             tal:attributes="checked field/createindex|nothing"/>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
            <div class="row">
              <div class="field">
                <input type="submit" value="Save changes" class="standalone" i18n:attributes="value">
              </div> 
            </div>
          </form>

          </div>
          </div>

        </td>
      </tr>
    </table>

  </div>
</body>
</html>
