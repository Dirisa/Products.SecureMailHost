<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone"
      tal:define="cpPath request/cpPath | here/absolute_url;
                  here python:here.isPrincipiaFolderish and here or here.aq_parent;
                  addPanel request/addPanel | string:edit;
                  pageIndex request/pageIndex; 
                  columnIndex request/columnIndex;
                  panelIndex request/panelIndex;
                  viewletId request/viewletId | string:default_viewlet;
                  paramString string:cpPath=$cpPath&amp;addPanel=$addPanel&amp;pageIndex=$pageIndex&amp;panelIndex=$panelIndex&amp;columnIndex=$columnIndex;

                  path python:here.portal_url.getRelativeContentURL(here);
                  baseurl string:${cpPath}/contentpanels_config?addPanel=${addPanel}&amp;pageIndex=$pageIndex&amp;columnIndex=$columnIndex&amp;panelIndex=$panelIndex&amp;panelObjectPath=$path&amp;panelObjectViewlet=;
                  typeId python: here.getTypeInfo().getId();
                  viewlets python: here.portal_contentpanels.listFilteredActionsFor(here);
                  pt_viewlets python:viewlets.get('PT:' + typeId, []);
                  pt_viewlets python: [viewlet for viewlet in pt_viewlets if (viewlet['id']!='contentpanels_viewlet' or here.absolute_url() != cpPath)];
                  gl_viewlets python:viewlets.get('GL:content', []) + viewlets.get('GL:all', []);
                  gl_viewlets python:test(here.isPrincipiaFolderish, viewlets.get('GL:folder', [])+gl_viewlets, gl_viewlets);
                  gn_portal_viewlets python:viewlets.get('GN:portal', []);
                  gn_personal_viewlets python:viewlets.get('GN:personal', []); ">

<head tal:define="ztu modules/ZTUtils;">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"
          tal:define="charset site_properties/default_charset|string:utf-8;
                      dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % charset)"
          tal:attributes="content string:text/html;;charset=${charset}" />

<title tal:content="string:panel at ${pageIndex}-${columnIndex}-${panelIndex}">new panel at x/x/x</title>

<style type="text/css" media="all"
       tal:define="current_skin python:ztu.make_query(skin=request.get(here.portal_skins.getRequestVarname(), ''))"
       tal:content="string:@import url(${here/portal_url}/plone.css?${current_skin});">
</style>

</head>
      
<body onload="focus();">
<div class="documentContent">

    <fieldset>
        <legend i18n:translate="viewlet_context" i18n:domain="contentpanels">viewlet context</legend>
    <div tal:define="breadcrumbs python:here.breadcrumbs(here)" style="white-space:nowrap;">
        <a tal:repeat="crumb python:breadcrumbs[:-2]"
           tal:content="python: crumb[0] + ' / '"
           tal:attributes="href python: crumb[1] + template.getId() + '?' + paramString">Parent
        </a>
        <img src="#"  i18n:attributes="title"
               tal:attributes="src string:${here/portal_url}/${here/getIcon};
                               title python:here.getTypeInfo().Title()"/>
        <strong tal:content="here/Title"/>
    </div>

    <div tal:condition="here/isPrincipiaFolderish"
         class="discreet">
    
      <span style="white-space:nowrap;"
            tal:repeat="item python:here.contentValues()[:100]">
          <img src="#"  i18n:attributes="title"
               tal:attributes="src string:${here/portal_url}/${item/getIcon};
                               title python:item.getTypeInfo().Title()"/>
          <a tal:attributes="href string:${item/absolute_url}/${template/getId}?$paramString"
             tal:content="python:item.Title() or item.getId()">Title</a>
      </span>
    </div>
    </fieldset>

    <fieldset>
       <legend i18n:translate="preview_viewlet" i18n:domain="contentpanels">preview viewlet</legend>

       <tal:repeat repeat="viewlet python:pt_viewlets + gl_viewlets + gn_portal_viewlets + gn_personal_viewlets">
          <a href="#" style="white-space:nowrap; border-bottom: 1px solid; margin-right: 0.5em"
             tal:condition="python:viewlet['id'] != viewletId"
             i18n:translate="" i18n:domain="contentpanels"
             tal:attributes="href string:${here/absolute_url}/${template/getId}?$paramString&amp;viewletId=${viewlet/id}"
             tal:content="viewlet/name">viewlet name</a>

          <a style="white-space:nowrap; border: 1px dashed; margin-right: 0.5em; background-color: #dee7ec;"
             title="select this viewlet"
             i18n:attributes="title select_this_viewlet" i18n:domain="contentpanels"
             tal:condition="python:viewlet['id'] == viewletId">
              <input type="checkbox" id="select_the_viewlet"
                     tal:attributes="onclick string:opener.location.href='${baseurl}${viewlet/id}';; window.close();;">
              <label tal:content="viewlet/name" for="select_the_viewlet" i18n:translate="" i18n:domain="contentpanels">viewlet name</label>
          </a>

       </tal:repeat>

      <hr/>
      <div tal:define="viewletPath python:here.portal_contentpanels.getViewletPath(viewletId)"
          tal:content="structure python:here.base_panel(here, contentpanels=here, panelSkin='', viewletPath=viewletPath)"/>

    </fieldset>
</div>
</body>
</html>


