<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone"
      tal:define="cpPath request/cpPath | here/absolute_url;
                  pageIndex request/pageIndex; 
                  columnIndex request/columnIndex;
                  panelIndex request/panelIndex;
                  paramString string:cpPath=$cpPath&pageIndex=$pageIndex&panelIndex=$panelIndex&columnIndex=$columnIndex">

<head tal:define="ztu modules/ZTUtils;">
<title tal:content="string: new panel at ${pageIndex}-${columnIndex}-${panelIndex}">new panel at x/x/x</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"
          tal:define="charset site_properties/default_charset|string:utf-8;
                      dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % charset)"
          tal:attributes="content string:text/html;;charset=${charset}" />
<style type="text/css" media="all"
       tal:define="current_skin python:ztu.make_query(skin=request.get(here.portal_skins.getRequestVarname(), ''))"
       tal:content="string: @import url(${here/portal_url}/plone.css?${current_skin});">
</style>
</head>
      
<body onload="focus();" style="margin: 4px;">

  <form class="group"
        action="search" 
        method="post" 
        name="search" 
        tal:define="DateTime python:modules['DateTime'].DateTime"
        tal:attributes="action string: ${here/absolute_url}/${template/getId}">

   <span i18n:translate="legend_search_terms">Search Terms</span>		 
   <div class="field">
    <input type="text" 
           name="Title" 
           size="25"
           />

    <input type="hidden" name="pageIndex" tal:attributes="value pageIndex"/>
    <input type="hidden" name="columnIndex" tal:attributes="value columnIndex">
    <input type="hidden" name="panelIndex" tal:attributes="value panelIndex">

    <input tabindex=""
           type="submit" 
           name="submit" 
           value="Search"
           i18n:attributes="value" 
           />
   </div>                
  </form>

  <tal:block 
   tal:define="query_results python:[brain.getObject() for brain in here.queryCatalog()[:100]];">    

   <div tal:condition="query_results">
        <span i18n:translate="heading_search_results">Search results</span>
   </div> 

   <div tal:condition="not: query_results"
        tal:define="breadcrumbs python:here.breadcrumbs(here)">

     <a tal:attributes="href string:${here/portal_url}/${template/getId}?$paramString">Home /
     </a>

     <a tal:repeat="crumb python:breadcrumbs[:-1]"
        tal:content="python: crumb[0] + ' / '"
        tal:attributes="href python: crumb[1] + template.getId() + '?' + paramString">Parent
     </a>

   </div>

 
 
   <tal:block tal:define="checkPermission python: here.portal_membership.checkPermission;
                          results python: test(query_results, query_results,
                                          [item for item in here.contentValues()
                                          if checkPermission('View',item)]);">

   <table tal:condition="results"
          class="group" width="100%" cellspacing="0" cellpadding="2">
 
    <tbody>
    <tal:block tal:repeat="item python:results[:100]">
     <tr tal:define="oddrow repeat/item/odd"
         tal:attributes="class python:test(oddrow, 'even', 'odd')" > 
    
      <td width="50%">
        <a tal:condition="python: item.isPrincipiaFolderish and item<>here"
           tal:attributes="href string: ${item/absolute_url}/${template/getId}?$paramString"
           tal:content="item/title_or_id">Title</a>
        
        <b tal:condition="python: not item.isPrincipiaFolderish or item==here"
           tal:content="item/title_or_id">Title</b>
      </td>

      <td width="25%" 
          i18n:translate="" 
          tal:content="python:item.getTypeInfo().Title()">Metatype</td>      
            
      <td width="25%" 
          tal:define="path python:here.portal_url.getRelativeContentURL(item);">
        <input type="checkBox" 
               tal:attributes="onclick string:opener.location.href='${cpPath}/contentpanels_config?addPanel=1&pageIndex=$pageIndex&columnIndex=$columnIndex&panelIndex=$panelIndex&panelObjectPath=$path';; window.close();;"/>
      </td>
     </tr>
     </tal:block>
    </tbody>
   </table>
  </tal:block>
 </tal:block> 
</body>
</html>

