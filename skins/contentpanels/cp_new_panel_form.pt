<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone"
      tal:define="cpPath request/cpPath | here/absolute_url;
                  addPanel request/addPanel | string:edit;
                  pageIndex request/pageIndex; 
                  columnIndex request/columnIndex;
                  panelIndex request/panelIndex;
                  isQuery request/isQuery | python: 0;
                  paramString string:cpPath=$cpPath&amp;addPanel=$addPanel&amp;pageIndex=$pageIndex&amp;panelIndex=$panelIndex&amp;columnIndex=$columnIndex;

                  path python:here.portal_url.getRelativeContentURL(here);
                  baseurl string:${cpPath}/contentpanels_config?addPanel=${addPanel}&amp;pageIndex=$pageIndex&amp;columnIndex=$columnIndex&amp;panelIndex=$panelIndex&amp;panelObjectPath=$path&amp;panelObjectViewlet=;
                  typeId python: here.getTypeInfo().getId();
                  viewlets python: here.portal_contentpanels.listFilteredActionsFor(here);
                  pt_viewlets python:viewlets.get('PT:' + typeId, []);
                  pt_viewlets python: [viewlet for viewlet in pt_viewlets if (viewlet['id']!='contentpanels_viewlet' or here.absolute_url() != cpPath)];
                  gl_viewlets python:viewlets.get('GL:content', []) + viewlets.get('GL:all', []);
                  gl_viewlets python:test(here.isPrincipiaFolderish, viewlets.get('GL:folder', [])+gl_viewlets, gl_viewlets);
                  gn_portal_viewlets python:viewlets.get('GN:portal', []);
                  gn_personal_viewlets python:viewlets.get('GN:personal', []); ">

<head tal:define="ztu modules/ZTUtils;">
<title tal:content="string:new panel at ${pageIndex}-${columnIndex}-${panelIndex}">new panel at x/x/x</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"
          tal:define="charset site_properties/default_charset|string:utf-8;
                      dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % charset)"
          tal:attributes="content string:text/html;;charset=${charset}" />
<style type="text/css" media="all"
       tal:define="current_skin python:ztu.make_query(skin=request.get(here.portal_skins.getRequestVarname(), ''))"
       tal:content="string:@import url(${here/portal_url}/plone.css?${current_skin});">
</style>

<!-- Pull-down ECMAScript menu, only active if logged in -->
<script     type="text/javascript"
            tal:attributes="src string:${here/portal_url}/plone_menu.js">
</script>

</head>
      
<body onload="focus();">

<div class="documentEditable">

    <!-- simulating views on the groups/user pages until we have real objects. -->
    <ul class="contentViews">
        <li class="" tal:attributes="class python:test(isQuery, '', 'selected')">
            <a href=""
               tal:attributes="href string:${here/portal_url}/${template/getId}?$paramString"
               i18n:translate="box_navigation">Navigation</a>
        </li>

        <li class="selected" tal:attributes="class python:test(isQuery, 'selected', '')">
            <a href=""
               tal:attributes="href string:${here/portal_url}/${template/getId}?$paramString&amp;isQuery:int=1"
               i18n:translate="">Search</a>
        </li>
    </ul>

    <div class="contentActions">
    &nbsp;
    </div>
    <!-- End of tabs -->

    <div class="documentContent">

       <!-- naviagation page -->
       <div tal:condition="not: isQuery">

          <div tal:define="breadcrumbs python:here.breadcrumbs(here)">

             <a tal:repeat="crumb python:breadcrumbs[:-2]"
                tal:content="python: crumb[0] + ' / '"
                tal:attributes="href python: crumb[1] + template.getId() + '?' + paramString">Parent
             </a>
         </div>

          <h1 class="documentFirstHeading" tal:content="here/Title"></h1>

          <div class="discreet" tal:content="here/Description"></div>


<div style="margin-top: 1em"><b>related portlets: </b></div>
<div class="contentActions">
<ul>

   <tal:block tal:repeat="menu python:(
                     {'viewlets':gn_personal_viewlets, 'title':'personal related', 'id':'gn_personal_viewlets'},
                     {'viewlets':gn_portal_viewlets, 'title':'site wide', 'id':'gn_portal_viewlets'},
                     {'viewlets':gl_viewlets, 'title':'content related', 'id':'globalViewlets'},
                     {'viewlets':pt_viewlets, 'title':'content specific', 'id':'typesSpecific'},
                     )">

      <li tal:condition="menu/viewlets">
        <div class="menuPosition">
            <a href="#"
               tal:attributes="onclick string:return buttonClick(event, '${menu/id}');;;
                               onmouseover string:buttonMouseover(event, '${menu/id}');;;">
               <span i18n:translate=""
                     tal:content="menu/title">types specific</span></a>

            <ul class="actionMenu" style=" display: block;"
                tal:attributes="id menu/id"
                onmouseover="menuMouseover(event)">
                <metal:block tal:repeat="viewlet menu/viewlets">
                <li>
                    <a href="#"
                       onMouseUp="if (activeButton != null) resetButton(activeButton);"
                       tal:attributes="onclick string:opener.location.href='${baseurl}${viewlet/id}';; window.close();;"
                       tal:content="viewlet/name">viewlet </a>
                </li>
                </metal:block>
            </ul>
        </div>
    </li>

  </tal:block>
</ul>
</div>
     </div>

       <!-- search form -->

       <form class="group"
             tal:condition="isQuery"
             action="search"
             method="post"
             name="search"
             tal:define="DateTime python:modules['DateTime'].DateTime"
             tal:attributes="action string:${here/absolute_url}/${template/getId}">

             <span i18n:translate="legend_search_terms">Search Terms</span>
             <div class="field">
                   <input name="SearchableText"
                          size="25"
                          tal:attributes="value request/SearchableText | nothing"
                          />

                  <input type="hidden" name="pageIndex" tal:attributes="value pageIndex"/>
                  <input type="hidden" name="columnIndex" tal:attributes="value columnIndex"/>
                  <input type="hidden" name="panelIndex" tal:attributes="value panelIndex"/>
                  <input type="hidden" name="cpPath" tal:attributes="value cpPath"/>
                  <input type="hidden" name="isQuery:int" value="1"/>

                  <input tabindex=""
                         type="submit"
                         name="submit"
                         value="Search"
                         i18n:attributes="value"
                         />
           </div>
      </form>

      <!-- the list -->

    <fieldset tal:define="checkPermission python: here.portal_membership.checkPermission;
                       results python:test(isQuery,[brain.getObject() for brain in here.queryCatalog()[:100]], 
                              [item for item in here.contentValues() if checkPermission('View',item)])"
              tal:condition="results">
    <legend>content list</legend>
      <div 
          tal:repeat="item python:results[:100]"
          tal:attributes="class python:test(repeat['item'].odd(), 'even', 'odd')" >

          <img src="#" tal:attributes="src string:${here/portal_url}/${item/getIcon}" />
          <a tal:attributes="href string:${item/absolute_url}/${template/getId}?$paramString"
             tal:content="python:item.Title() or item.getId()">Title</a>

          <span class="discreet"
                i18n:translate=""
                tal:content="python:item.getTypeInfo() and item.getTypeInfo().Title()">Metatype</span>

      </div>
    </fieldset>
    </div> 
</div>
</body>
</html>


